<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>1A2B çŒœæ•¸å­—éŠæˆ²</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Arial", sans-serif;
      }
      .game-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        padding: 40px;
        max-width: 500px;
        width: 100%;
      }
      .game-title {
        color: #667eea;
        font-weight: bold;
        margin-bottom: 30px;
        text-align: center;
      }
      .guess-input {
        font-size: 1.2rem;
        text-align: center;
      }
      .btn-custom {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px 30px;
        font-size: 1.1rem;
      }
      .btn-custom:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .history-list {
        max-height: 200px;
        overflow-y: auto;
      }
      .stats {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
      }
      .emoji {
        font-size: 3rem;
        text-align: center;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1 class="game-title">1A2B çŒœæ•¸å­—éŠæˆ²</h1>

      <!-- éŠæˆ²çµ±è¨ˆ -->
      <div class="stats">
        <div class="row text-center">
          <div class="col-4">
            <div class="fw-bold">å˜—è©¦æ¬¡æ•¸</div>
            <div class="fs-4 text-primary" id="attempts">0</div>
          </div>
          <div class="col-4">
            <div class="fw-bold">æœ€é«˜åˆ†</div>
            <div class="fs-4 text-success" id="bestScore">-</div>
          </div>
          <div class="col-4">
            <div class="fw-bold">éŠæˆ²å ´æ¬¡</div>
            <div class="fs-4 text-warning" id="range">1</div>
          </div>
        </div>
      </div>

      <!-- æç¤ºè¨Šæ¯ -->
      <div id="message" class="alert alert-secondary text-center" role="alert">
        é–‹å§‹çŒœæ¸¬å§ï¼
      </div>

      <!-- è¼¸å…¥å€åŸŸ -->
      <div class="mb-3">
        <input
          type="text"
          class="form-control guess-input"
          id="guessInput"
          placeholder="è¼¸å…¥4ä½æ•¸å­—"
          maxlength="4"
          pattern="[0-9]*"
        />
      </div>

      <!-- æŒ‰éˆ•å€ -->
      <div class="d-grid gap-2 mb-3">
        <button
          class="btn btn-primary btn-custom"
          id="guessBtn"
          onclick="makeGuess()"
        >
          çŒœæ¸¬
        </button>
        <button class="btn btn-outline-secondary" onclick="resetGame()">
          é‡æ–°é–‹å§‹
        </button>
        <button class="btn btn-outline-warning" onclick="showAnswer()">
          æŸ¥çœ‹ç­”æ¡ˆ
        </button>
      </div>

      <!-- æ­·å²è¨˜éŒ„ -->
      <div class="card">
        <div class="card-header">
          <strong>çŒœæ¸¬æ­·å²</strong>
        </div>
        <div class="card-body history-list" id="history">
          <p class="text-muted text-center">å°šç„¡çŒœæ¸¬è¨˜éŒ„</p>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- éŠæˆ²é‚è¼¯ -->
    <script>
      let targetNumber;
      let attempts = 0;
      let guessHistory = [];
      let bestScore = localStorage.getItem("bestScore") || null;
      let gameCount = parseInt(localStorage.getItem("gameCount")) || 0;

      // ç”Ÿæˆä¸é‡è¤‡çš„4ä½æ•¸å­—
      function generateTargetNumber() {
        const digits = [];
        while (digits.length < 4) {
          const digit = Math.floor(Math.random() * 10);
          if (!digits.includes(digit)) {
            digits.push(digit);
          }
        }
        return digits.join("");
      }

      // åˆå§‹åŒ–éŠæˆ²
      function initGame() {
        targetNumber = generateTargetNumber();
        attempts = 0;
        guessHistory = [];
        gameCount++;
        localStorage.setItem("gameCount", gameCount);
        updateDisplay();

        // é¡¯ç¤ºæœ€é«˜åˆ†
        if (bestScore) {
          document.getElementById("bestScore").textContent = bestScore;
        }

        // é¡¯ç¤ºéŠæˆ²å ´æ¬¡
        document.getElementById("range").textContent = gameCount;

        console.log("ç­”æ¡ˆæ˜¯ï¼š", targetNumber); // é–‹ç™¼æ™‚ç”¨ï¼Œæ­£å¼ç‰ˆå¯ç§»é™¤
      }

      // è¨ˆç®— A å’Œ B
      function calculateAB(guess, target) {
        let A = 0;
        let B = 0;

        for (let i = 0; i < 4; i++) {
          if (guess[i] === target[i]) {
            A++;
          } else if (target.includes(guess[i])) {
            B++;
          }
        }

        return { A, B };
      }

      // é©—è­‰è¼¸å…¥
      function validateInput(guess) {
        // æª¢æŸ¥é•·åº¦
        if (guess.length !== 4) {
          return "è«‹è¼¸å…¥4ä½æ•¸å­—ï¼";
        }

        // æª¢æŸ¥æ˜¯å¦éƒ½æ˜¯æ•¸å­—
        if (!/^\d+$/.test(guess)) {
          return "è«‹åªè¼¸å…¥æ•¸å­—ï¼";
        }

        // æª¢æŸ¥æ˜¯å¦æœ‰é‡è¤‡æ•¸å­—
        const digits = guess.split("");
        if (new Set(digits).size !== 4) {
          return "æ•¸å­—ä¸èƒ½é‡è¤‡ï¼";
        }

        return null;
      }

      // çŒœæ¸¬å‡½æ•¸
      function makeGuess() {
        const guessInput = document.getElementById("guessInput");
        const guess = guessInput.value.trim();

        // é©—è­‰è¼¸å…¥
        const error = validateInput(guess);
        if (error) {
          showMessage(error, "warning", "âš ï¸");
          return;
        }

        // æª¢æŸ¥æ˜¯å¦é‡è¤‡çŒœæ¸¬
        if (guessHistory.some((h) => h.guess === guess)) {
          showMessage("ä½ å·²ç¶“çŒœéé€™å€‹æ•¸å­—äº†ï¼", "warning", "ğŸ”„");
          return;
        }

        attempts++;
        const result = calculateAB(guess, targetNumber);
        guessHistory.push({ guess, ...result });
        updateDisplay();

        // åˆ¤æ–·çµæœ
        if (result.A === 4) {
          showMessage(
            `ğŸ‰ æ­å–œä½ ï¼ç­”æ¡ˆå°±æ˜¯ ${targetNumber}ï¼ç¸½å…±çŒœäº† ${attempts} æ¬¡`,
            "success",
            "ğŸ‰"
          );
          document.getElementById("guessBtn").disabled = true;
          guessInput.disabled = true;

          // æ›´æ–°æœ€é«˜åˆ†ï¼ˆæœ€å°‘æ¬¡æ•¸ï¼‰
          if (!bestScore || attempts < bestScore) {
            bestScore = attempts;
            localStorage.setItem("bestScore", bestScore);
            document.getElementById("bestScore").textContent = bestScore;
          }
        } else {
          showMessage(
            `çµæœï¼š${result.A}A${result.B}Bï¼Œç¹¼çºŒåŠ æ²¹ï¼`,
            "info",
            "ğŸ¤”"
          );
        }

        // æ¸…ç©ºè¼¸å…¥
        guessInput.value = "";
        guessInput.focus();
      }

      // é¡¯ç¤ºè¨Šæ¯
      function showMessage(text, type, emoji) {
        const messageDiv = document.getElementById("message");

        messageDiv.className = `alert alert-${type} text-center`;
        messageDiv.textContent = text;
      }

      // æ›´æ–°é¡¯ç¤º
      function updateDisplay() {
        document.getElementById("attempts").textContent = attempts;

        const historyDiv = document.getElementById("history");
        if (guessHistory.length === 0) {
          historyDiv.innerHTML =
            '<p class="text-muted text-center">å°šç„¡çŒœæ¸¬è¨˜éŒ„</p>';
        } else {
          historyDiv.innerHTML = guessHistory
            .map((item, index) => {
              let badge = "bg-secondary";
              if (item.A === 4) {
                badge = "bg-success";
              } else if (item.A >= 2) {
                badge = "bg-info";
              } else if (item.A + item.B >= 2) {
                badge = "bg-warning";
              }

              return `
                        <div class="mb-2">
                            <span class="badge ${badge} me-2">
                                ç¬¬${index + 1}æ¬¡: ${item.guess}
                            </span>
                            <span class="badge bg-dark">
                                ${item.A}A${item.B}B
                            </span>
                        </div>
                    `;
            })
            .join("");
        }
      }

      // é‡ç½®éŠæˆ²
      function resetGame() {
        document.getElementById("guessBtn").disabled = false;
        document.getElementById("guessInput").disabled = false;
        document.getElementById("guessInput").value = "";

        showMessage("é–‹å§‹çŒœæ¸¬å§ï¼", "secondary", "ğŸ¤”");

        initGame();
      }

      // æŸ¥çœ‹ç­”æ¡ˆ
      function showAnswer() {
        showMessage(`ç­”æ¡ˆæ˜¯ï¼š${targetNumber}`, "danger", "ğŸ‘€");
        document.getElementById("guessBtn").disabled = true;
        document.getElementById("guessInput").disabled = true;
      }

      // Enter éµæ”¯æ´
      document
        .getElementById("guessInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            makeGuess();
          }
        });

      // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
      window.onload = initGame;
    </script>
  </body>
</html>
